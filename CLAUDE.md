# CLAUDE.md

## 重要な制約事項

- **言語**: ユーザーとのやりとり、プログラム中のコメント、コミットメッセージ、Pull Requestの内容は日本語で記述する
- **CLIコマンド**: フルパスを利用して実行する

## プロジェクト構成

### フォルダ構造
```text
root/
├── src/                 # プログラミングコードを実装するフォルダ
├── docs/                # ドキュメントが格納されているフォルダ
│   └── specification.md # 仕様書
├── CLAUDE.md            # ClaudeCodeへの指示が書かれているファイル
└── README.md            # このプロジェクトのREADME
```

### 技術構成
- **プログラミング言語**: Go v1.24.4
- **静的解析**: golangci-lint (`golangci-lint run ./src/`)

## 開発ワークフロー

### 基本的な実装手順

1. **ブランチ準備**
   ```bash
   git switch main && git pull origin main
   git checkout -b [作業内容に沿ったブランチ名]
   ```

2. **TDD実装**
   以下を全TODOリストにチェックが付くまで繰り返す：
   - テストコード作成（対応するTODOを明記）
     - **ユニットテスト**: 対応するクラス1つに対して1つのテストファイル（例: `user.go` → `user_test.go`）
   - テスト実行（失敗確認）
   - 実装
   - テスト成功確認
   - TODOリストをチェック
   - 新たなテストが必要な場合はTODOリストに追加
   - golangci-lint実行
   - リファクタリング対象を特定（dupl、gocyclo等のissue）してTODOリストに追加（実装しない）
   - コミット

3. **品質確認**
   - テストカバレッジ確認（目標：80%以上）
   - golangci-lint最終実行（問題がないことを確認）
   - プルリクエスト作成

### 作業時の重要原則

- **CLIフルパス**: CLIツール利用時にパスを入力する場合はフルパスで入力
- **既存ファイル優先**: 新規ファイル作成より既存ファイル編集を優先
- **TODOリスト活用**: 作業項目を明確にし、完了確認を徹底
- **コメントルール**: 仕様はメソッドコメントとして残し、リファクタリング経緯等の歴史的コメントは削除
- **テスト名ルール**: t.Runのテスト名は日本語で記述し、条件と期待結果を含める
- **実装ステップ遵守**: 新機能・リファクタリング共にブランチ作成→テスト→実装の手順を適用
- **テストファースト**: 実装前にテストで期待する動作を先に定義
- **既存テスト保護**: 仕様変更せず内部実装のみ改善

## リファクタリング指針

### 重複コード判定基準（50行未満）
duplicツールで検出されない小規模な重複に対する基準：
- **完全重複**: 同じロジックが複数箇所に存在する場合は統合
- **冗長ラッパー**: 型変換のみで追加ロジックがないメソッドは削除対象
- **不要メソッド**: 基底クラス機能と同等で価値を追加しないメソッドは削除

### 推奨golangci-lintツール
- **dupl**: 重複コード検出
- **gocyclo**: 循環的複雑度測定
- **cyclop**: 関数・パッケージ複雑度チェック

詳細設定は [README.md](./README.md#推奨ツールリファクタリング対象検出用) と `.golangci.yml` を参照。

## 問題対応履歴

### 2025-06-28: TODOリスト未完了での早期完了報告

**問題**: TODOリストに未完了項目が残っている状態で「実装完了」を報告した

**原因**:
- 基本機能の実装が完了した時点で満足してしまい、TODOリストの確認を怠った
- "TDD実装"の「全TODOリストにチェックが付くまで繰り返す」という指示を見落とした
- リファクタリング項目を「優先度low」と軽視し、必須作業として認識しなかった

**影響**:
- ユーザーの信頼を損なう可能性
- 開発プロセスの遵守ができていない

**再発防止策**:
1. **TODOリスト必須チェック**: 作業完了報告前に必ずTodoRead툴을実行し、全項目がcompletedであることを確認する
2. **優先度の誤解防止**: priority:"low"であっても、TODOリストに追加された項目は全て必須作業として扱う
3. **段階的確認の強化**: 各段階で「次の作業に進む前にTODOリストを確認」を習慣化する
4. **完了条件の明文化**: 「全TODOが完了するまで作業継続」をより強調して記述する

この問題を受けて、今後は必ずTODOリストが完全に空になるまで作業を継続します。
# CLAUDE.md

## 重要な制約事項

- **言語**: ユーザーとのやりとり、プログラム中のコメント、コミットメッセージ、Pull Requestの内容は日本語で記述する
- **CLIコマンド**: フルパスを利用して実行する

## プロジェクト構成

### フォルダ構造
```text
root/
├── src/                 # プログラミングコードを実装するフォルダ
├── docs/                # ドキュメントが格納されているフォルダ
│   └── specification.md # 仕様書
├── CLAUDE.md            # ClaudeCodeへの指示が書かれているファイル
└── README.md            # このプロジェクトのREADME
```

### 技術構成
- **プログラミング言語**: Go v1.24.4

## 開発ワークフロー

### 実装ステップ

1. **ブランチ準備**
   - `git switch main && git pull origin main` でmainブランチを最新に更新
   - `git checkout -b [作業内容に沿ったブランチ名]` で作業ブランチを作成・切り替え

2. **テスト設計**
   - テスト用ファイルを作成（新規作成より既存ファイル編集を優先）
   - テスト内容をクラスコメントにチェックリスト形式で記載
   - テスト項目確定段階でコミット

3. **TDD実装サイクル**
   以下を全TODOリストにチェックが付くまで繰り返す：
   - テストコードのみを実装（対応するTODOを明記）
   - テスト実行してエラーを確認
   - エラーを解消する実装を行う
   - テスト成功まで実装・修正を継続
   - 新たなテストが必要な場合はTODOリストに追加
   - テスト成功時にTODOリストをチェック
   - コードレビューでリファクタリングタスクを特定・追加（実装しない）
   - `git commit -m {作業内容}` でコミット

4. **品質確認**
   - テストカバレッジ確認（目標：80-100%）
   - 不足時はTODOリストに追加して3のサイクルを継続
   - プルリクエスト作成・レビュー依頼

### 作業時の重要原則

- **TODOリスト完全確認**: 作業完了前に全項目がチェック済みであることを必ず確認
- **既存ファイル優先**: 新規ファイル作成より既存ファイル編集を優先（理由説明が必要な場合のみ新規作成）
- **歴史的コメント削除**: リファクタリング時の「〜に統合済み」等の経緯コメントは残さない

## リファクタリング指針

### 基本方針
- **実装ステップの完全遵守**: 新機能実装と同じ手順（ブランチ作成→テスト→実装）を必ず適用
- **テストファースト**: リファクタリング後の構造をテストするコードを先に作成・修正
- **段階的コミット**: テスト修正とリファクタリング実装を分離
- **既存テスト保護**: 仕様変更せず内部実装のみ改善

### 重複コード判定基準
- **完全重複**: 同じロジックが複数箇所に存在する場合は必ず統合
- **冗長ラッパー**: 型変換のみで追加ロジックがないメソッドは削除対象
- **不要メソッド**: 基底クラス機能と同等で価値を追加しないメソッドは削除

### 実行手順
1. **分析**: 重複・冗長箇所を特定
2. **テスト修正**: 新構造に対応するテストコードを作成
3. **テスト確認**: 修正後テストの成功を確認
4. **実装統合**: 冗長部分を削除・統合
5. **最終確認**: 全テストの成功を確認

### 品質指標
- **コード重複率**: 5%以下を目標
- **テストカバレッジ**: リファクタリング前と同等以上を維持
- **設計原則**: DRY、単一責任、開放閉鎖原則の遵守

### よくあるパターン
- **メソッド重複**: 基底クラス/インターフェースに共通実装を移動
- **ラッパー削除**: 基底クラスメソッドの直接使用に変更
- **テスト統合**: テーブル駆動テスト、パラメータ化テストの活用
- **インターフェース抽出**: 共通メソッドセットの統一
# CLAUDE.md

## 重要な制約事項

- **言語**: ユーザーとのやりとり、プログラム中のコメント、コミットメッセージ、Pull Requestの内容は日本語で記述する
- **CLIコマンド**: フルパスを利用して実行する

## プロジェクト構成

### フォルダ構造
```text
root/
├── src/                 # プログラミングコードを実装するフォルダ
├── docs/                # ドキュメントが格納されているフォルダ
│   └── specification.md # 仕様書
├── CLAUDE.md            # ClaudeCodeへの指示が書かれているファイル
└── README.md            # このプロジェクトのREADME
```

### 技術構成
- **プログラミング言語**: Go v1.24.4
- **静的解析**: golangci-lint (`golangci-lint run ./src/`)

## 開発ワークフロー

### 基本的な実装手順

1. **ブランチ準備**
   ```bash
   git switch main && git pull origin main
   git checkout -b [作業内容に沿ったブランチ名]
   ```

2. **TDD実装**
   **重要**: 以下を**全TODOリストが完全にcompletedになるまで**繰り返す：
   - テストコード作成（対応するTODOを明記）
     - **ファイル対応ルール**: 実装ファイル1つに対してテストファイル1つの厳密な1:1対応
       - 例: `user.go` → `user_test.go`、`money.go` → `money_test.go`
       - **禁止**: 複数の実装ファイルを1つのテストファイルでテストすること
       - **禁止**: 1つの実装ファイルを複数のテストファイルに分割すること
       - **統合ルール**: 関連する複数クラスが同一ファイルにある場合、そのテストも同一ファイルに統合
   - テスト実行（失敗確認）
   - 実装
   - テスト成功確認
   - **TODOリスト必須確認**: `TodoRead`ツールを実行し、現在のTODO状況を確認
   - 完了したTODOを`completed`にマーク
   - **品質チェックと即時対応**:
     - golangci-lint実行（フルパス: `golangci-lint run ./src/`）
     - 検出されたissueは**即座に修正**（TODOリストに追加せず、その場で対応）
     - 全てのissueが解消されるまで次に進まない
     - issueが0件になったことを確認
   - **コミット条件**: golangci-lintでissueが0件の場合のみコミット実行
   - 新たなテストが必要な場合はTODOリストに追加

3. **品質確認と完了確認**
   - テストカバレッジ確認（目標：80%以上）
   - golangci-lint最終実行（問題がないことを確認）
   - **完了前最終チェック**: `TodoRead`ツールで全項目が`completed`であることを確認
   - **完了条件**: 全TODOリストが空になるか、全て`completed`状態になるまで作業継続
   - プルリクエスト作成

### 作業時の重要原則

- **CLIフルパス**: CLIツール利用時にパスを入力する場合はフルパスで入力
- **既存ファイル優先**: 新規ファイル作成より既存ファイル編集を優先
- **ファイル構成ルール**: 
  - 実装ファイルとテストファイルは必ず1:1対応
  - テストファイル名は実装ファイル名+`_test`（例: `user.go` → `user_test.go`）
  - 複数のテストファイルが同じ実装をテストしている場合は統合必須
  - 1つのテストファイルで複数の実装ファイルをテストしている場合は分割必須
- **TODOリスト活用**: 作業項目を明確にし、完了確認を徹底
- **TODOリスト必須ルール**: 
  - 各作業段階で`TodoRead`ツールを実行し進捗確認
  - 優先度に関係なく、TODOリストの全項目は必須作業として扱う
  - `priority:"low"`であってもリファクタリング含めて必ず完了させる
  - 作業完了報告前に全項目が`completed`であることを必ず確認
- **コメントルール**: 仕様はメソッドコメントとして残し、リファクタリング経緯等の歴史的コメントは削除
- **テスト名ルール**: 
  - t.Runのテスト名は**必ず日本語**で記述
  - 条件と期待結果を含める（例：「5と10を加算した場合、15が返される」）
  - テーブル駆動テストでも同じルールを適用
  - 英語のテスト名は**一切禁止**
- **実装ステップ遵守**: 新機能・リファクタリング共にブランチ作成→テスト→実装の手順を適用
- **テストファースト**: 実装前にテストで期待する動作を先に定義
- **既存テスト保護**: 仕様変更せず内部実装のみ改善
- **品質即時対応ルール**:
  - TODO完了ごとにgolangci-lint実行を必須化
  - 検出されたissueは即座に修正（後回し禁止）
  - issue 0件確認後にのみコミット許可
  - 「リファクタリング対象」としてTODOリストに追加することを禁止

## リファクタリング指針

### 重複コード判定基準（50行未満）
duplicツールで検出されない小規模な重複に対する基準：
- **完全重複**: 同じロジックが複数箇所に存在する場合は統合
- **冗長ラッパー**: 型変換のみで追加ロジックがないメソッドは削除対象
- **不要メソッド**: 基底クラス機能と同等で価値を追加しないメソッドは削除

### 推奨golangci-lintツール
- **dupl**: 重複コード検出
- **gocyclo**: 循環的複雑度測定
- **cyclop**: 関数・パッケージ複雑度チェック

詳細設定は [README.md](./README.md#推奨ツールリファクタリング対象検出用) と `.golangci.yml` を参照。
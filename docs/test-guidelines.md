# テストガイドライン

## テストファイル対応強化ルール

### 基本原則
実装ファイルとテストファイルの**厳密な1:1対応**を維持し、**実装の責務とテストの責務を完全一致**させる。

### 強制ルール

#### 1. ファイル対応と責務の原則
```text
実装ファイル1つ ⟷ テストファイル1つ ⟷ 同一責務

例:
✅ base.go      ⟷ base_test.go      : 基底クラス機能（基本操作、共通機能）
✅ typeA.go     ⟷ typeA_test.go     : TypeAコンストラクタ機能のみ  
✅ typeB.go     ⟷ typeB_test.go     : TypeBコンストラクタ機能のみ
✅ service.go   ⟷ service_test.go   : Service機能（ビジネスロジック、処理）
```

#### 2. 違反パターンと対処法

**❌ 違反例: 実装責務とテスト責務の不一致**
```text
// typeA.go: コンストラクタのみ実装
func NewTypeA(value int) BaseType { ... }

// typeA_test.go: 基底クラス機能もテスト（違反）
func TestTypeAの計算(t *testing.T) { ... }  // ← Calculateはbase.goの責務
```

**✅ 修正: 責務に応じたテスト配置**
```text
// typeA_test.go: コンストラクタ機能のみテスト
func TestTypeAの作成(t *testing.T) { ... }

// base_test.go: 基底クラス機能をテスト
func TestBaseTypeの計算(t *testing.T) { ... }
```

#### 3. テスト内容の責務分担

**各テストファイルの厳密な責務**:
- **base_test.go**: 基底クラスの全機能（共通メソッド、基本操作等）
- **typeA_test.go**: NewTypeA関数の動作のみ（作成テストのみ）
- **typeB_test.go**: NewTypeB関数の動作のみ（作成テストのみ）
- **service_test.go**: Service機能（ビジネスロジック、処理等）

#### 4. 禁止事項

**絶対禁止**:
- 基底クラスメソッドを派生クラスのテストファイルでテストすること
- 「継承確認」を理由とした責務外テストの実装
- 「型固有の動作」と称した基底クラス機能の重複テスト

#### 5. 重複コード判定

**許可される重複**: なし（設計が正しければ重複は発生しない）
**違反となる重複**: 異なるテストファイル間での同一機能テスト

#### 6. 修正手順

**責務違反発見時の対応**:
1. **即座修正**: 違反を発見したら他の作業を中断して即座に修正
2. **適切な移動**: テストを正しい責務のファイルに移動
3. **重複削除**: 移動後に重複テストを削除
4. **検証**: golangci-lintでdupl違反が0件であることを確認

## テスト命名とコメントルール

### テスト関数命名規則
```go
// TestEquality tests BaseType.Equals method behavior
// 期待: 同じ値のオブジェクト同士は等しく、異なる値の場合は等しくないと判定される
func TestEquality(t *testing.T) {
    tests := []struct {
        name     string  // 必ず日本語で記述
        // ...
    }{
        {
            name: "同じ値のオブジェクト同士の場合、等しいと判定される",  // 日本語
            // ...
        },
    }
}
```

### 必須要件
- **テスト関数名**: 英語で記述（例：`TestNewTypeA`, `TestEquality`）
- **テスト関数コメント**: 必須記述（何をテストし、何を期待するかを記述）
- **t.Runのテスト名**: 日本語で記述（実行時の可読性のため）

### コメント形式
```go
// Test[FunctionName] tests [Type/Package].Method behavior
// 期待: [期待する動作の詳細説明]
func Test[FunctionName](t *testing.T) { ... }
```

## レビューチェックポイント

### プルリクエスト作成前の必須確認
- [ ] 実装責務とテスト責務が完全一致している
- [ ] `golangci-lint run .`でdupl違反が0件である
- [ ] 各テストファイルの責務がコメントで明記されている
- [ ] 基底クラステストが適切なファイルに配置されている
- [ ] テスト関数名が英語で、適切なコメントが記述されている
- [ ] t.Runのテスト名が日本語で記述されている

### 継続的な保守
- 新規実装ファイル作成時は責務に応じたテストファイルを作成
- 責務違反を発見したら即座に修正（後回し禁止）
- テスト命名規則に従って記述

## 品質基準

### 必須品質チェック
1. **テスト成功**: 全テストが成功すること
2. **Lint問題なし**: `golangci-lint run .`で0 issues
3. **重複コードなし**: dupl警告が0件
4. **責務一致**: 実装ファイルとテストファイルの責務が完全一致
5. **命名規則遵守**: テスト関数名とコメントが規則に従っている

### テストカバレッジ
- **目標**: 80%以上
- **測定**: 各機能の主要パス
- **例外**: 明らかに不要な部分（単純なgetter、setter等）

## 例外ルール

### 統合テスト
- **許可条件**: 複数クラス間の連携テストのみ
- **ファイル名**: `integration_test.go`
- **前提条件**: 単体テストが各実装ファイルで完了済み

### 制約
- 統合テストは単体テストの代替にはならない
- 責務分担の原則は統合テストでも適用
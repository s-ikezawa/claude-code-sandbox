# 開発ワークフロー

## 開発開始前の必須準備

### 1. 仕様理解と要件分析（最重要）

**仕様理解漏れ防止チェックリスト**：
- [ ] **Overview/概要セクション**を最優先で精読し、システムの目的を理解
- [ ] **具体例・実例**を特定し、それらを統合テストとして最初に設計
- [ ] **クラス一覧**だけでなく、**システム全体の動作**を把握
- [ ] 単体機能と統合機能の両方を明確に分離して理解

**禁止事項**：
- クラス一覧のみに注目して全体像を見失うこと
- 具体例を後回しにすること
- 段階的実装を理由に統合的な動作確認を軽視すること

### 2. TODOリスト作成（要件ベース）

**必須項目を以下の順序で追加**：
1. ブランチ作成
2. **仕様書の具体例テスト作成**（ブランチ作成後の最優先）
3. 各機能の設計・実装・テスト（単体機能）
4. 統合テスト完成
5. 品質チェック
6. **プルリクエスト作成**（必須項目）

**重要**: テストやコード作成は必ずブランチ作成後に実行すること

### 3. ブランチ準備
```bash
git switch main && git pull origin main
git checkout -b [作業内容に沿ったブランチ名]
```

## 基本的な実装手順

### 1. **TDD実装（TODO1つごとのサイクル）**
   **重要**: TODOリストから**1つずつ**取り出し、以下の手順を**必ず完了させてから次のTODOに進む**：
   
   **TODO単位の作業サイクル**：
   1. `TodoRead`でTODOリストを確認し、次の1つを選択
   2. 選択したTODOを`in_progress`にマーク
   3. テストコード作成（対応するTODOを明記）
      - **ファイル対応ルール**: 実装ファイル1つに対してテストファイル1つの厳密な1:1対応
        - 例: `user.go` → `user_test.go`、`money.go` → `money_test.go`
        - **禁止**: 複数の実装ファイルを1つのテストファイルでテストすること
        - **禁止**: 1つの実装ファイルを複数のテストファイルに分割すること
        - **統合ルール**: 関連する複数クラスが同一ファイルにある場合、そのテストも同一ファイルに統合
   4. テスト実行（失敗確認）
   5. 実装
   6. テスト成功確認
   7. **品質チェックと即時対応**:
      - golangci-lint実行（フルパス: `golangci-lint run ./src/`）
      - 検出されたissueは**即座に修正**（TODOリストに追加せず、その場で対応）
      - 全てのissueが解消されるまで次に進まない
      - issueが0件になったことを確認
   8. 現在のTODOを`completed`にマーク
   9. **必須コミット**: 1つのTODO完了ごとに必ずコミット（複数TODO分をまとめてコミットすることを禁止）
   10. 次のTODOへ（手順1に戻る）
   
   **禁止事項**：
   - 複数のTODOを同時に`in_progress`にすること
   - コミットせずに次のTODOに進むこと
   - 複数TODO分の変更を1つのコミットにまとめること

### 2. **品質確認と完了確認**
- テストカバレッジ確認（目標：80%以上）
- golangci-lint最終実行（問題がないことを確認）
- **完了前最終チェック**: `TodoRead`ツールで全項目が`completed`であることを確認
- **完了条件**: 全TODOリストが空になるか、全て`completed`状態になるまで作業継続

### 3. **プルリクエスト作成（必須）**
- **コミット漏れチェック**: `git status`でコミットされていないファイルがないことを確認
- 作業ツリーがクリーンであることを確認
- ブランチをリモートにプッシュ
- GitHub上でプルリクエスト作成
- **注意**: この工程を忘れやすいため、必ずTODOリストに明記すること

## 作業時の重要原則

### 1. 仕様理解漏れ防止（最重要）
- **仕様書の優先読解順序**:
  1. **Overview/概要** → システムの目的と全体像の把握
  2. **具体例・実例** → 期待する動作の具体的理解
  3. **クラス一覧** → 実装すべき構成要素の確認
- **統合テスト優先原則**: 仕様書の具体例を最初にテストとして実装
- **全体像確認**: 単体機能だけでなく、システム全体としての動作を常に意識

### 2. TODOリスト管理
- **作業項目の明確化**: 全作業をTODOリストで管理し、完了確認を徹底
- **必須項目の網羅**: 
  - ブランチ作成を最初の項目として配置
  - **仕様書の具体例テスト**をブランチ作成後の最優先項目として配置
  - プルリクエスト作成を必ずTODOリストに含める（忘れやすいため重要）
  - 優先度に関係なく、全項目は必須作業として扱う（`priority:"low"`も必ず完了）
- **進捗管理**:
  - 各作業段階で`TodoRead`ツールを実行し進捗確認
  - 作業完了報告前に全項目が`completed`であることを必ず確認

### 3. TODO単位の作業サイクル
- **単一タスク原則**: 同時に複数TODOを`in_progress`にすることを禁止
- **コミット規則**: 1つのTODO完了ごとに必ずコミット（まとめてコミット禁止）
- **品質保証**: 各TODO完了時にgolangci-lint実行とissue即時修正
- **記録**: コミットメッセージは完了したTODO内容を明記

### 4. 品質管理
- **即時対応**: 検出されたissueは即座に修正（後回し禁止）
- **完了条件**: issue 0件確認後にのみコミット・次のTODOへ進行許可
- **禁止事項**: 「リファクタリング対象」としてTODOリストに追加することを禁止

### 5. 開発規則
- **テストファースト**: 実装前にテストで期待する動作を先に定義（TDD）
- **統合テスト優先**: 仕様書の具体例を最初にテスト実装し、システム全体の動作を確認
- **既存コード尊重**: 
  - 新規ファイル作成より既存ファイル編集を優先
  - 仕様変更せず内部実装のみ改善（既存テスト保護）
- **テストルール遵守**: [test-guidelines.md](./test-guidelines.md)を必読・遵守

### 6. その他の規則
- **CLIフルパス**: CLIツール利用時にパスを入力する場合はフルパスで入力
- **コメントルール**: 仕様はメソッドコメントとして残し、リファクタリング経緯等の歴史的コメントは削除

## 仕様理解漏れ防止のための注意点

### よくある失敗パターンと対策

#### 失敗パターン1: クラス一覧重視による全体像の見落とし
- **問題**: クラス設計に注目しすぎて、システムの目的を見失う
- **対策**: Overview/概要を最優先で理解し、具体例をテストとして最初に実装

#### 失敗パターン2: 段階的実装による統合機能の後回し
- **問題**: 「まず基本から」の思考で、重要な統合機能を最後に発見
- **対策**: 仕様書の具体例を最初のTODOとして必ず配置

#### 失敗パターン3: 要件分析の不十分さ
- **問題**: 仕様書から機能を完全にリストアップしていない
- **対策**: 仕様理解チェックリストを必ず実行し、具体例から逆算して必要機能を洗い出す